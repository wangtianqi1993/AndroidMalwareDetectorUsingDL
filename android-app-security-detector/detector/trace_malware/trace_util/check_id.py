# !/usr/bin/env python
# -*- coding: utf-8 -*-
__author__ = 'wtq'

import os
import json

id_card_path = os.path.abspath(os.path.join(os.path.dirname(__file__), os.pardir))

chmap = {
    '0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9,
    'x': 10, 'X': 10
}


def ch_to_num(ch):
    return chmap[ch]


def verify_id_card(s):
    """
    验证输入的身份证号是否合法
    :param s:
    :return:
    """
    char_list = list(s)
    try:
        num_list = [ch_to_num(ch) for ch in char_list]
        return verify_list(num_list)
    except Exception, e:
        return 0


def verify_list(l):
    sum = 0
    try:
        for ii, n in enumerate(l):
            i = 18 - ii
            weight = 2 ** (i - 1) % 11
            sum = (sum + n * weight) % 11
    except Exception, e:
        print 'extrace, error', e
    return sum == 1


def check_id(id_card):
    """
    判断身份证号是否合法，是则给出归属地
    :param id_card:
    :return:
    """
    result = verify_id_card(id_card)
    if result:
        with open(id_card_path+"/result/id_area_match.json", 'r') as f:
            id_to_area = json.load(f)
            sub_s = [tmp[i] for i in range(6)]
            sub_s = "".join(sub_s)
            if sub_s in id_to_area:
                print id_to_area[sub_s]
                return id_to_area
        print "Valid"
    else:
        print "Invalid"
    return 0

if __name__ == '__main__':
    tmp = '211381199307276112'  # 输入要检验的字符串
    check_id(tmp)
